VuFind.Searches=function(){$(function(){VuFind.Searches.enableSearchTypes();VuFind.Searches.initAutoComplete();if(!Globals.opac&&!Globals.loggedIn&&VuFind.hasLocalStorage()&&$('input[name="showCovers"]').length==0){var showCovers=window.localStorage.getItem("showCovers")||false;if(showCovers.length>0){$("<input>").attr({type:"hidden",name:"showCovers",value:showCovers}).appendTo("#searchForm")}}});return{searchGroups:[],curPage:1,displayMode:"list",displayModeClasses:{covers:"home-page-browse-thumbnails",list:""},getCombinedResults:function(fullId,shortId,source,searchTerm,searchType,numberOfResults){var url=Globals.path+"/Union/AJAX";var params="?method=getCombinedResults&source="+source+"&numberOfResults="+numberOfResults+"&id="+fullId+"&searchTerm="+searchTerm+"&searchType="+searchType;if($("#hideCovers").is(":checked")){params+="&showCovers=off"}else{params+="&showCovers=on"}$.getJSON(url+params,function(data){if(data.success==false){VuFind.showMessage("Error loading results",data.error)}else{$("#combined-results-section-results-"+shortId).html(data.results)}}).fail(VuFind.ajaxFail);return false},combinedResultsDefinedOrder:[],reorderCombinedResults:function(){if($("#combined-results-column-0").is(":visible")){if($(".combined-results-column-0","#combined-results-column-0").length==0){$(".combined-results-column-0").detach().appendTo("#combined-results-column-0");$(".combined-results-column-1").detach().appendTo("#combined-results-column-1")}}else{if($(".combined-results-section","#combined-results-all-column").length==0){$.each(VuFind.Searches.combinedResultsDefinedOrder,function(i,id){el=$(id).parents(".combined-results-section").detach().appendTo("#combined-results-all-column")})}}return false},getPreferredDisplayMode:function(){if(!Globals.opac&&VuFind.hasLocalStorage()){temp=window.localStorage.getItem("searchResultsDisplayMode");if(VuFind.Searches.displayModeClasses.hasOwnProperty(temp)){VuFind.Searches.displayMode=temp;$('input[name="view"]',"#searchForm").val(VuFind.Searches.displayMode)}}},toggleDisplayMode:function(selectedMode){var mode=this.displayModeClasses.hasOwnProperty(selectedMode)?selectedMode:this.displayMode,searchBoxView=$('input[name="view"]',"#searchForm"),paramString=VuFind.replaceQueryParam("page","",VuFind.replaceQueryParam("view",mode));this.displayMode=mode;this.curPage=1;if(searchBoxView)searchBoxView.val(this.displayMode);if(!Globals.opac&&VuFind.hasLocalStorage()){window.localStorage.setItem("searchResultsDisplayMode",this.displayMode)}if(mode=="list")$("#hideSearchCoversSwitch").show();else $("#hideSearchCoversSwitch").hide();location.replace(location.pathname+paramString)},getMoreResults:function(){var url=Globals.path+"/Search/AJAX",params=VuFind.replaceQueryParam("page",this.curPage+1)+"&method=getMoreSearchResults",divClass=this.displayModeClasses[this.displayMode];params=VuFind.replaceQueryParam("view",this.displayMode,params);if(params.search(/[?;&]replacementTerm=/)!=-1){var searchTerm=location.search.split("replacementTerm=")[1].split("&")[0];params=VuFind.replaceQueryParam("lookfor",searchTerm,params)}$.getJSON(url+params,function(data){if(data.success==false){VuFind.showMessage("Error loading search information","Sorry, we were not able to retrieve additional results.")}else{var newDiv=$(data.records).hide();$("."+divClass).filter(":last").after(newDiv);newDiv.fadeIn("slow");if(data.lastPage)$("#more-browse-results").hide();else VuFind.Searches.curPage++}}).fail(VuFind.ajaxFail);return false},initAutoComplete:function(){try{$("#lookfor").autocomplete({source:function(request,response){var url=Globals.path+"/Search/AJAX?method=GetAutoSuggestList&searchTerm="+$("#lookfor").val();$.ajax({url:url,dataType:"json",success:function(data){response(data)}})},position:{my:"left top",at:"left bottom",of:"#lookfor",collision:"none"},minLength:4,delay:600})}catch(e){alert("error during autocomplete setup"+e)}},sendEmail:function(){if(Globals.loggedIn){var from=$("#from").val();var to=$("#to").val();var message=$("#message").val();var related_record=$("#related_record").val();var sourceUrl=window.location.href;var url=Globals.path+"/Search/AJAX";$.getJSON(url,{method:"sendEmail",from:from,to:to,message:message,sourceUrl:sourceUrl},function(data){if(data.result){VuFind.showMessage("Success",data.message)}else{VuFind.showMessage("Error",data.message)}})}return false},enableSearchTypes:function(){var searchTypeElement=$("#searchSource");var catalogType="catalog";if(searchTypeElement){var selectedSearchType=$(searchTypeElement.find(":selected"));if(selectedSearchType){catalogType=selectedSearchType.data("catalog_type")}}if(catalogType=="islandora"){$(".islandoraType").show();$(".catalogType,.genealogyType,.ebscoType").hide()}else if(catalogType=="genealogy"){$(".genealogyType").show();$(".catalogType,.islandoraType,.ebscoType").hide()}else if(catalogType=="ebsco"){$(".ebscoType").show();$(".catalogType,.islandoraType,.genealogyType").hide()}else{$(".catalogType").show();$(".genealogyType,.islandoraType,.ebscoType").hide()}},lastSpellingTimer:undefined,getSpellingSuggestion:function(query,process,isAdvanced){if(VuFind.Searches.lastSpellingTimer!=undefined){clearTimeout(VuFind.Searches.lastSpellingTimer);VuFind.Searches.lastSpellingTimer=undefined}var url=Globals.path+"/Search/AJAX?method=GetAutoSuggestList&searchTerm="+query;if(isAdvanced){}VuFind.Searches.lastSpellingTimer=setTimeout(function(){$.get(url,function(data){process(data)},"json")},500)},processSearchForm:function(){var searchSource=$("#searchSource");if(searchSource.val()=="existing"){$(".existingFilter").prop("checked",true);var originalSearchSource=$("#existing_search_option").data("original_type");searchSource.val(originalSearchSource)}},resetSearchType:function(){if($("#lookfor").val()==""){$("#searchSource").val($("#default_search_type").val())}return true},updateSearchTypes:function(catalogType,searchType,searchFormId){if(catalogType=="catalog"){$("#basicType").val(searchType);$("#genealogyType").remove();$("#islandoraType").remove();$("#ebscoType").remove()}else if(catalogType=="archive"){$("#islandoraType").val(searchType);$("#genealogyType").remove();$("#ebscoType").remove();$("#basicType").remove()}else if(catalogType=="ebsco"){$("#ebscoType").val(searchType);$("#genealogyType").remove();$("#islandoraType").remove();$("#basicType").remove()}else{$("#genealogyType").val(searchType);$("#basicType").remove();$("#islandoraType").remove();$("#ebscoType").remove()}$(searchFormId).submit();return false},filterAll:function(){$(".existingFilter").prop("checked",true)},loadExploreMoreBar:function(section,searchTerm){var url=Globals.path+"/Search/AJAX";var params="method=loadExploreMoreBar&section="+encodeURIComponent(section);params+="&searchTerm="+encodeURIComponent(searchTerm);var fullUrl=url+"?"+params;$.getJSON(fullUrl,function(data){if(data.success==true){$("#explore-more-bar-placeholder").html(data.exploreMoreBar);VuFind.initCarousels()}})}}}(VuFind.Searches||{});